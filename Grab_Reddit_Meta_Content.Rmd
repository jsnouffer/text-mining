---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.2.3
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import praw
from elasticsearch import Elasticsearch
from datetime import datetime
```

## Setup Reddit API and ElasticSearch Connection

```{python}
reddit = praw.Reddit(client_id='Cz8OU1vxajnWDw',
                     client_secret='5qax29ZPI2_Rdjc1TsXXEypFduk',
                     redirect_uri='http://localhost:8080',
                     user_agent='my user agent')

print(reddit.auth.url(['identity'], '...', 'permanent'))

es = Elasticsearch([{'host':'localhost','port':9200}])
es
```

```{python}
# Grab popular subreddits
for subreddit in reddit.subreddits.popular():
    doc = {
        "id": subreddit.display_name,
        "title": subreddit.title,
        "description": subreddit.public_description,
        "subscribers": subreddit.subscribers,
        "created": datetime.fromtimestamp(subreddit.created_utc).isoformat(),
        "language": subreddit.lang,
        "category": subreddit.advertiser_category
    }
    
    # Ingest into Elastic
    es.index(index='reddit_meta', doc_type='subreddits.popular', id=subreddit.display_name, body=doc)
    
```
